<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Resource Management</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .resource-details, .request-details { font-style: italic; color: #666; }
        .admin-controls { margin-bottom: 20px; }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Admin Resource Management</h1>
    <div class="admin-controls">
        <h2>Manage Resources</h2>
        <input type="text" id="resourceName" placeholder="Resource Name">
        <input type="text" id="resourceDetails" placeholder="Resource Details">
        <button onclick="addResource()">Add Resource</button>
        <input type="hidden" id="resourceId">
        <button onclick="updateResource()">Update Resource</button>
    </div>
    <h2>Resource and Request Data</h2>
    <table>
        <thead>
            <tr>
                <th>Resource Name</th>
                <th>Resource Details</th>
                <th>Request ID</th>
                <th>Request Details</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="data-table-body"></tbody>
    </table>
    <h2>Most Requested Resources</h2>
    <canvas id="requestChart"></canvas>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCXGnKdWdVmi2Z98DCZSYKV_nHx9zH7xRg",
            authDomain: "system-galacticgeeks.firebaseapp.com",
            databaseURL: "https://system-galacticgeeks-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "system-galacticgeeks",
            storageBucket: "system-galacticgeeks.firebasestorage.app",
            messagingSenderId: "835850762785",
            appId: "1:835850762785:web:d2e42efe2422dac089c160",
            measurementId: "G-5S4L5M5GG5"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function addResource() {
            const name = document.getElementById('resourceName').value;
            const details = document.getElementById('resourceDetails').value;
            if (name.trim() === "" || details.trim() === "") {
                alert("Please enter valid resource details.");
                return;
            }
            const newResourceRef = db.ref('resources').push();
            newResourceRef.set({ name, details })
                .then(() => alert("Resource added successfully"))
                .catch(error => console.error("Error adding resource:", error));
        }

        function updateResource() {
            const resourceId = document.getElementById('resourceId').value;
            const name = document.getElementById('resourceName').value;
            const details = document.getElementById('resourceDetails').value;
            if (resourceId) {
                db.ref(`resources/${resourceId}`).update({ name, details })
                    .then(() => alert("Resource updated successfully"))
                    .catch(error => console.error("Error updating resource:", error));
            } else {
                alert("No resource selected for update.");
            }
        }

        function updateStatus(requestId, status, comment) {
            db.ref(`requests/${requestId}`).update({ status: { status, comment } })
                .then(() => alert(`Request ${status.toLowerCase()}`))
                .catch(error => console.error("Error updating status:", error));
        }

        function deleteResource(resourceId) {
            db.ref(`resources/${resourceId}`).remove()
                .then(() => alert("Resource deleted successfully"))
                .catch(error => console.error("Error deleting resource:", error));
        }

        function populateTable(resources, requests) {
            const tbody = document.getElementById('data-table-body');
            tbody.innerHTML = '';
            for (const resourceId in resources) {
                const resource = resources[resourceId];
                const request = requests[resourceId] || {};
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${resource.name}</td>
                    <td class="resource-details">${resource.details}</td>
                    <td>${request.id || 'N/A'}</td>
                    <td class="request-details">${request.details || ''}</td>
                    <td>${request.status ? request.status.status : 'Pending'}</td>
                    <td>
                        <button onclick="updateStatus('${resourceId}', 'Approved', 'Approved by Admin')">Approve</button>
                        <button onclick="updateStatus('${resourceId}', 'Rejected', 'Rejected by Admin')">Reject</button>
                        <button onclick="deleteResource('${resourceId}')">Delete</button>
                        <button onclick="editResource('${resourceId}', '${resource.name}', '${resource.details}')">Edit</button>
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        function editResource(resourceId, name, details) {
            document.getElementById('resourceId').value = resourceId;
            document.getElementById('resourceName').value = name;
            document.getElementById('resourceDetails').value = details;
        }

        function loadChart(requests) {
            const labels = Object.keys(requests);
            const data = labels.map(id => requests[id].count || 1);
            new Chart(document.getElementById('requestChart'), {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{ label: 'Requests', data, backgroundColor: 'blue' }]
                }
            });
        }

        // Real-time data fetching with event listeners
        db.ref('resources').on('value', (resourcesSnap) => {
            const resources = resourcesSnap.val() || {};
            db.ref('requests').once('value')
                .then((requestsSnap) => {
                    const requests = requestsSnap.val() || {};
                    populateTable(resources, requests);
                    loadChart(requests);
                })
                .catch(error => console.error("Error fetching requests:", error));
        });

    </script>
</body>
</html>
